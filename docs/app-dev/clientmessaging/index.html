<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Client Messaging | </title><meta name=description content='Application extensions and the Onshape JavaScript web client need to communicate directly, calling across the iframe containing the application extension using post message.
Onshape Client Messaging examples can be split into those that are initiated from the application extension and those that are initiated from the Onshape client.
Messages from the Extension These Client Messaging examples can be initiated from the application extension:
Click/close flyouts events: Notify the Onshape client that the user has clicked in the application extension, which should cause Onshape flyouts (versions, history, uploads, etc.) and dropdown menus (profile dropdown menu, document menu) to close. Without this, flyouts and menus might remain open over the application extension. Shortcut keyboard events: Shortcut keys (such as ?, which opens the Onshape Help dialog), can be handled by the application extension by posting a message to the Onshape client to open the dialog. keepAlive: Notify the Onshape client that the user is actively working in the application extension, which triggers the Onshape client to send a message to the server to keep the browser session alive. Without this, the Onshape browser session will timeout and ask the user to sign in again. Standard Onshape dialogs: Request from the application extension to the Onshape client to open one of the Onshape standard dialogs and send the user’s choices back to the application extension. For example, if the application extension needs the user to choose a part or assembly to be operated on, the application extension can post a message to the Onshape client requesting that dialog be opened and the selected part or assembly information sent back to the application extension. UI customization": Request from the application extension to the Onshape client to customize the Onshape UI (e.g., add commands to menus, add buttons to the toolbars, etc). When these commands or toolbar buttons are clicked, the Onshape client posts a message to the application extension with the available context. Note: This is limited to cases where the application extension is made active by the user; application extensions are not automatically loaded when a document is opened. Most UI customizations should be done when you register the application with Onshape, as those change the Onshape client automatically without needing to load the application extension first. Content/material insertion: Request from the application extension to insert content into the Onshape document. For example, insert a part into a new or existing Part Studio, apply a material to a part, add a material to a material library, etc. Messages from Onshape The following examples can be initiated from the Onshape client:'><meta property="og:url" content="https://onshape-public.github.io/docs/app-dev/clientmessaging/"><meta property="og:title" content="Client Messaging"><meta property="og:description" content='Application extensions and the Onshape JavaScript web client need to communicate directly, calling across the iframe containing the application extension using post message.
Onshape Client Messaging examples can be split into those that are initiated from the application extension and those that are initiated from the Onshape client.
Messages from the Extension These Client Messaging examples can be initiated from the application extension:
Click/close flyouts events: Notify the Onshape client that the user has clicked in the application extension, which should cause Onshape flyouts (versions, history, uploads, etc.) and dropdown menus (profile dropdown menu, document menu) to close. Without this, flyouts and menus might remain open over the application extension. Shortcut keyboard events: Shortcut keys (such as ?, which opens the Onshape Help dialog), can be handled by the application extension by posting a message to the Onshape client to open the dialog. keepAlive: Notify the Onshape client that the user is actively working in the application extension, which triggers the Onshape client to send a message to the server to keep the browser session alive. Without this, the Onshape browser session will timeout and ask the user to sign in again. Standard Onshape dialogs: Request from the application extension to the Onshape client to open one of the Onshape standard dialogs and send the user’s choices back to the application extension. For example, if the application extension needs the user to choose a part or assembly to be operated on, the application extension can post a message to the Onshape client requesting that dialog be opened and the selected part or assembly information sent back to the application extension. UI customization": Request from the application extension to the Onshape client to customize the Onshape UI (e.g., add commands to menus, add buttons to the toolbars, etc). When these commands or toolbar buttons are clicked, the Onshape client posts a message to the application extension with the available context. Note: This is limited to cases where the application extension is made active by the user; application extensions are not automatically loaded when a document is opened. Most UI customizations should be done when you register the application with Onshape, as those change the Onshape client automatically without needing to load the application extension first. Content/material insertion: Request from the application extension to insert content into the Onshape document. For example, insert a part into a new or existing Part Studio, apply a material to a part, add a material to a material library, etc. Messages from Onshape The following examples can be initiated from the Onshape client:'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="Client Messaging"><meta itemprop=description content='Application extensions and the Onshape JavaScript web client need to communicate directly, calling across the iframe containing the application extension using post message.
Onshape Client Messaging examples can be split into those that are initiated from the application extension and those that are initiated from the Onshape client.
Messages from the Extension These Client Messaging examples can be initiated from the application extension:
Click/close flyouts events: Notify the Onshape client that the user has clicked in the application extension, which should cause Onshape flyouts (versions, history, uploads, etc.) and dropdown menus (profile dropdown menu, document menu) to close. Without this, flyouts and menus might remain open over the application extension. Shortcut keyboard events: Shortcut keys (such as ?, which opens the Onshape Help dialog), can be handled by the application extension by posting a message to the Onshape client to open the dialog. keepAlive: Notify the Onshape client that the user is actively working in the application extension, which triggers the Onshape client to send a message to the server to keep the browser session alive. Without this, the Onshape browser session will timeout and ask the user to sign in again. Standard Onshape dialogs: Request from the application extension to the Onshape client to open one of the Onshape standard dialogs and send the user’s choices back to the application extension. For example, if the application extension needs the user to choose a part or assembly to be operated on, the application extension can post a message to the Onshape client requesting that dialog be opened and the selected part or assembly information sent back to the application extension. UI customization": Request from the application extension to the Onshape client to customize the Onshape UI (e.g., add commands to menus, add buttons to the toolbars, etc). When these commands or toolbar buttons are clicked, the Onshape client posts a message to the application extension with the available context. Note: This is limited to cases where the application extension is made active by the user; application extensions are not automatically loaded when a document is opened. Most UI customizations should be done when you register the application with Onshape, as those change the Onshape client automatically without needing to load the application extension first. Content/material insertion: Request from the application extension to insert content into the Onshape document. For example, insert a part into a new or existing Part Studio, apply a material to a part, add a material to a material library, etc. Messages from Onshape The following examples can be initiated from the Onshape client:'><meta itemprop=wordCount content="3189"><meta name=twitter:card content="summary"><meta name=twitter:title content="Client Messaging"><meta name=twitter:description content='Application extensions and the Onshape JavaScript web client need to communicate directly, calling across the iframe containing the application extension using post message.
Onshape Client Messaging examples can be split into those that are initiated from the application extension and those that are initiated from the Onshape client.
Messages from the Extension These Client Messaging examples can be initiated from the application extension:
Click/close flyouts events: Notify the Onshape client that the user has clicked in the application extension, which should cause Onshape flyouts (versions, history, uploads, etc.) and dropdown menus (profile dropdown menu, document menu) to close. Without this, flyouts and menus might remain open over the application extension. Shortcut keyboard events: Shortcut keys (such as ?, which opens the Onshape Help dialog), can be handled by the application extension by posting a message to the Onshape client to open the dialog. keepAlive: Notify the Onshape client that the user is actively working in the application extension, which triggers the Onshape client to send a message to the server to keep the browser session alive. Without this, the Onshape browser session will timeout and ask the user to sign in again. Standard Onshape dialogs: Request from the application extension to the Onshape client to open one of the Onshape standard dialogs and send the user’s choices back to the application extension. For example, if the application extension needs the user to choose a part or assembly to be operated on, the application extension can post a message to the Onshape client requesting that dialog be opened and the selected part or assembly information sent back to the application extension. UI customization": Request from the application extension to the Onshape client to customize the Onshape UI (e.g., add commands to menus, add buttons to the toolbars, etc). When these commands or toolbar buttons are clicked, the Onshape client posts a message to the application extension with the available context. Note: This is limited to cases where the application extension is made active by the user; application extensions are not automatically loaded when a document is opened. Most UI customizations should be done when you register the application with Onshape, as those change the Onshape client automatically without needing to load the application extension first. Content/material insertion: Request from the application extension to insert content into the Onshape document. For example, insert a part into a new or existing Part Studio, apply a material to a part, add a material to a material library, etc. Messages from Onshape The following examples can be initiated from the Onshape client:'><link rel=preload href=/scss/main.min.7622946b88aadfa24dcf933afaf03525457e05cdace62229bf02030f0a66d236.css as=style><link href=/scss/main.min.7622946b88aadfa24dcf933afaf03525457e05cdace62229bf02030f0a66d236.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><style>code{white-space:pre-wrap!important;overflow-wrap:break-word}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-3CY8X7Q128"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3CY8X7Q128")}</script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg width="95" height="22" viewBox="0 0 95 22" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.35.0l3.6143 2.09524L3.45714 7.72619V12.5714L0 10.5548V5.44762L9.35.0zm9.4286 16.2643-3.6143 2.1476V7.64763L10.7905 5.08097l3.6666-2.12143 4.3215 2.51428V16.2643zM0 12.3619v3.9809l9.45476 5.4215 4.21664-2.4881L13.6452 15.1381 9.35 17.7048.0 12.3619z" fill="#64bc4f"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4.9762 10.5811 6.57381 11.4978V9.42871L10.9214 6.88824 9.35001 5.91919 4.9762 8.48586V10.5811zm6.8881-3.14291L10.2667 8.35485 12.1 9.42866 12.0738 14.3263 13.6714 13.4096V8.4858L11.8643 7.43819zm-.7072 5.68331v1.781L9.35001 15.9763 4.9762 13.4358V11.6549l4.34762 2.5405 1.83328-1.0739z" fill="#666"/><path fill-rule="evenodd" clip-rule="evenodd" d="M56.5452 3.16919V8.01443C56.8595 7.59538 57.2523 7.2549 57.6976 6.94062 58.1428 6.65252 58.6666 6.49538 59.2428 6.49538s1.0738.07857 1.4929.23571C61.1547 6.88824 61.5214 7.15014 61.8357 7.46443 62.5428 8.17157 62.9095 9.11443 62.9095 10.2668v5.081H61.5999V10.3454C61.5999 9.53348 61.3642 8.9049 60.919 8.43347c-.4452-.47142-1.0476-.70714-1.7548-.70714-.7333.0-1.3619.23572-1.8595.73333C56.7809 8.95728 56.5452 9.58586 56.5452 10.3716v5.0285H55.2357V3.16919h1.3095zM49.7881 7.64775c1.3357.0 2.069.44524 2.1738 1.3619V8.95727h1.3095C53.1928 8.25013 52.9047 7.67394 52.3809 7.25489 51.7786 6.75727 50.9405 6.49537 49.8666 6.49537c-1.1261.0-1.9642.209519999999999-2.5404.65476-.5762.41905-.8643 1.04762-.8643 1.83333C46.4619 9.53346 46.5928 9.92632 46.8809 10.2406 47.169 10.5287 47.5357 10.7644 47.9547 10.9477 48.4 11.1311 48.8714 11.262 49.369 11.3668 49.8928 11.4716 50.3643 11.5763 50.7833 11.7073 51.2024 11.8382 51.569 11.9954 51.8571 12.1787 52.1452 12.3882 52.2762 12.6501 52.2762 13.0168 52.2762 13.5406 51.9881 13.9335 51.4381 14.143L51.3476 14.1703C51.1209 14.2391 50.91 14.3032 50.6786 14.3263 50.4166 14.3525 50.1286 14.3787 49.8405 14.3787S49.2643 14.3525 48.95 14.2477C48.1119 13.9597 47.6666 13.4358 47.5881 12.6239H46.2262C46.2785 13.462 46.619 14.1168 47.2476 14.6406c.680900000000001.5762 1.6238.8643 2.7762.8643 1.1.0 1.9643-.2357 2.5928-.680999999999999C53.2714 14.3787 53.5857 13.7239 53.5857 12.8858 53.5857 12.3358 53.4547 11.9168 53.1667 11.6025 52.8786 11.2882 52.5119 11.0525 52.0928 10.8692 51.6476 10.6858 51.1762 10.5549 50.6786 10.4501 50.2403 10.3844 49.8387 10.282 49.4738 10.1889L49.4734 10.1888 49.4721 10.1885C49.4015 10.1705 49.3322 10.1528 49.2643 10.1358 48.8452 10.0311 48.4785 9.87394 48.1905 9.69061 47.9024 9.50727 47.7714 9.24537 47.7714 8.90489 47.7714 8.0668 48.4524 7.64775 49.7881 7.64775zM30.9309 6.52152c1.3095.0 2.3572.44524 3.1691 1.30952C34.8595 8.66914 35.2523 9.74295 35.2523 11.0263 35.2523 12.3096 34.8595 13.3834 34.1 14.2215 33.2881 15.0858 32.2404 15.531 30.9309 15.531s-2.3571-.4452-3.169-1.3095C27.0023 13.3834 26.6095 12.3096 26.6095 11.0263 26.6095 9.74295 27.0023 8.66914 27.7619 7.83104 28.5738 6.96676 29.6214 6.52152 30.9309 6.52152zm0 7.80478C31.8738 14.3263 32.6071 14.012 33.1571 13.3572 33.6809 12.7287 33.9428 11.9691 33.9428 11.0263 33.9428 10.0834 33.6809 9.29771 33.1571 8.69533 32.6071 8.04057 31.8738 7.72628 30.9309 7.72628 29.9881 7.72628 29.2547 8.04057 28.7047 8.69533 28.1809 9.3239 27.919 10.0834 27.919 11.0263 27.919 11.9691 28.1809 12.7549 28.7047 13.3572 29.2285 14.012 29.9881 14.3263 30.9309 14.3263zm7.3595-7.64764V8.04057C38.6047 7.62152 38.9976 7.28104 39.4428 6.96676 39.8881 6.67866 40.4119 6.52152 40.9881 6.52152c.576099999999997.0 1.0738.07857 1.4928.23571C42.9 6.91438 43.2666 7.17628 43.5809 7.49057 44.2881 8.19771 44.6547 9.14057 44.6547 10.2929v5.081H43.3452V10.3453C43.3452 9.53343 43.1095 8.90485 42.6642 8.43342c-.4452-.47142-1.0476-.70714-1.7547-.70714C40.1761 7.72628 39.5476 7.962 39.05 8.45961 38.5261 8.95723 38.2904 9.58581 38.2904 10.3715v5.0286H36.9809V6.67866h1.3095zM68.7762 15.531C70.1643 15.531 71.1857 15.0072 71.8928 13.9858v1.3881h1.3095V6.65247H71.8928V8.06676C71.1857 7.04533 70.1643 6.52152 68.8547 6.52152 67.5452 6.52152 66.4976 6.96676 65.7119 7.83104 64.9524 8.69533 64.5595 9.76914 64.5595 11.0263c0 1.2833.392899999999997 2.3309 1.1524 3.1952C66.4976 15.0858 67.519 15.531 68.7762 15.531zM71.1857 13.3572C70.6357 14.012 69.9023 14.3263 68.9595 14.3263 68.0166 14.3263 67.2571 14.012 66.7071 13.3572 66.1571 12.7549 65.8952 11.9691 65.8952 11.0263 65.8952 10.0834 66.1571 9.3239 66.7071 8.69533 67.2833 8.04057 68.0428 7.72628 68.9595 7.72628 69.9023 7.72628 70.6357 8.04057 71.1857 8.69533 71.7095 9.29771 71.9714 10.0834 71.9714 11.0263 71.9714 11.9691 71.7095 12.7287 71.1857 13.3572zM76.7643 8.06676C77.4714 7.04533 78.4928 6.52152 79.8809 6.52152c1.2572.0 2.2786.44524 3.0381 1.30952C83.7047 8.69533 84.0976 9.74295 84.0976 11.0263 84.0976 12.2834 83.7047 13.3572 82.919 14.2215 82.1333 15.0858 81.0857 15.531 79.7762 15.531 78.4666 15.531 77.4452 15.0072 76.7381 13.9858v4.8714H75.4285V6.67866h1.3096v1.3881H76.7643zM79.7238 7.70009C78.7809 7.70009 78.0476 8.01438 77.4976 8.66914 76.9738 9.29771 76.7119 10.0572 76.7119 11.0001 76.7119 11.9429 76.9738 12.7287 77.4976 13.331 78.0476 13.9858 78.7809 14.3001 79.7238 14.3001 80.6404 14.3001 81.4 13.9858 81.9762 13.331 82.5262 12.7025 82.7881 11.9429 82.7881 11.0001 82.7881 10.0572 82.5262 9.27152 81.9762 8.66914 81.4 8.04057 80.6404 7.70009 79.7238 7.70009zM92.2167 12.8597C91.719 13.8287 90.8809 14.3263 89.7024 14.3263c-.8643.0-1.5715-.261900000000001-2.1215-.8119C87.0309 12.9906 86.7167 12.3358 86.6119 11.5239H93.919v-.5238C93.919 9.7168 93.5262 8.64299 92.7667 7.80489 91.9548 6.94061 90.9071 6.49537 89.5976 6.49537s-2.3571.44524-3.169 1.30952C85.669 8.64299 85.2762 9.7168 85.2762 11.0001c0 1.2834.392799999999994 2.3572 1.2047 3.1953C87.2929 15.0597 88.3667 15.5049 89.6762 15.5049c1.0476.0 1.8857-.2357 2.54050000000001-.7333C92.8714 14.3001 93.3429 13.6454 93.6571 12.8597H92.2167zM87.5809 8.45965C88.1309 7.96203 88.7857 7.70013 89.5976 7.70013S91.0643 7.96203 91.6143 8.45965C92.1381 8.93108 92.4524 9.55965 92.5571 10.3192H86.6381C86.769 9.55965 87.0571 8.93108 87.5809 8.45965z" fill="#666"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://cad.onshape.com/glassworks/explorer/ target=_blank rel=noopener><span>API Explorer</span></a></li><li class=nav-item><a class=nav-link href=https://cad.onshape.com target=_blank rel=noopener><span>Onshape</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.1a547613be269983f0d4d7e3403a7ebb.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.1a547613be269983f0d4d7e3403a7ebb.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ title="Welcome to the Onshape Developer Documentation" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Welcome</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsapi-intro-li><a href=/docs/api-intro/ title="Introduction to the Onshape REST API" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsapi-intro><span>API Intro</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-introexplorer-li><a href=/docs/api-intro/explorer/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-introexplorer><span>API Explorer</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-introquickstart-li><a href=/docs/api-intro/quickstart/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-introquickstart><span>Quick Start</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-introarchitecture-li><a href=/docs/api-intro/architecture/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-introarchitecture><span>Architecture</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-introwhyonshape-li><a href=/docs/api-intro/whyonshape/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-introwhyonshape><span>Why Onshape?</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsauth-li><a href=/docs/auth/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsauth><span>Authentication</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsauthoauth-li><a href=/docs/auth/oauth/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsauthoauth><span>OAuth</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsauthapikeys-li><a href=/docs/auth/apikeys/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsauthapikeys><span>API Keys</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsapi-adv-li><a href=/docs/api-adv/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsapi-adv><span>API Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advassemblies-li><a href=/docs/api-adv/assemblies/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advassemblies><span>Assemblies</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advassociativity-li><a href=/docs/api-adv/associativity/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advassociativity><span>Associativity</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advbilling-li><a href=/docs/api-adv/billing/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advbilling><span>Billing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advconfigs-li><a href=/docs/api-adv/configs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advconfigs><span>Configurations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advdocuments-li><a href=/docs/api-adv/documents/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advdocuments><span>Documents</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advdrawings-li><a href=/docs/api-adv/drawings/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advdrawings><span>Drawings</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advfeatureaccess-li><a href=/docs/api-adv/featureaccess/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advfeatureaccess><span>Features</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advfs-li><a href=/docs/api-adv/fs/ title="Evaluating FeatureScript" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advfs><span>FeatureScript</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advtranslation-li><a href=/docs/api-adv/translation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advtranslation><span>Import & Export</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advmetadata-li><a href=/docs/api-adv/metadata/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advmetadata><span>Metadata</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-advpartstudios-li><a href=/docs/api-adv/partstudios/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-advpartstudios><span>Part Studios</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapi-adverrors-li><a href=/docs/api-adv/errors/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapi-adverrors><span>Response Codes</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsapp-dev-li><a href=/docs/app-dev/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsapp-dev><span>App Development</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsapp-devextensions-li><a href=/docs/app-dev/extensions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapp-devextensions><span>Extensions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsapp-devclientmessaging-li><a href=/docs/app-dev/clientmessaging/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docsapp-devclientmessaging><span class=td-sidebar-nav-active-item>Client Messaging</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsapp-devstructuredstorage-li><a href=/docs/app-dev/structuredstorage/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapp-devstructuredstorage><span>Structured Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsapp-devwebhook-li><a href=/docs/app-dev/webhook/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapp-devwebhook><span>Webhooks</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsapp-store-li><a href=/docs/app-store/ title="Onshape App Store" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsapp-store><span>App Store</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapp-storechecklist-li><a href=/docs/app-store/checklist/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapp-storechecklist><span>Launch Checklist</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapp-storetestingguidelines-li><a href=/docs/app-store/testingguidelines/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapp-storetestingguidelines><span>Testing Guidelines</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsapp-storequality-li><a href=/docs/app-store/quality/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsapp-storequality><span>Quality Considerations</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docstutorials-li><a href=/docs/tutorials/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docstutorials><span>Sample Apps</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docstutorialssync-li><a href=/docs/tutorials/sync/ title="Sync Data and Metadata" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialssync><span>Sync Data</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docstutorialsreleases-li><a href=/docs/tutorials/releases/ title="Sync Releases and Revisions" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsreleases><span>Sync Releases</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docstutorialsderivative-li><a href=/docs/tutorials/derivative/ title="Generate Derivative Files" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsderivative><span>Derivative Files</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docstutorialscreateextension-li><a href=/docs/tutorials/createextension/ title="Create an Extension" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialscreateextension><span>Extensions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docstutorialsgltf-li><a href=/docs/tutorials/gltf/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsgltf><span>glTF Viewer</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docshelp-li><a href=/docs/help/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docshelp><span>Get Help</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docschangelog-li><a href=/docs/changelog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docschangelog><span>Changelog</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#messages-from-the-extension>Messages from the Extension</a></li><li><a href=#messages-from-onshape>Messages from Onshape</a></li><li><a href=#security-considerations>Security Considerations</a></li><li><a href=#element-tab>Element Tab</a></li><li><a href=#element-right-panel>Element Right Panel</a></li><li><a href=#code-snippets>Code Snippets</a><ul><li><a href=#parse-query-parameters>Parse query parameters</a></li><li><a href=#create-a-message-object>Create a message object</a></li><li><a href=#listen-for-messages>Listen for messages</a></li><li><a href=#send-and-handle-messages>Send and handle messages</a></li><li><a href=#right-panel-interaction-sequence>Right panel interaction sequence</a></li><li><a href=#right-panel-message-exchange>Right panel message exchange</a></li></ul></li><li><a href=#notes>Notes</a><ul><li><a href=#keyboard-focus>Keyboard focus</a></li><li><a href=#future-work>Future work</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Welcome</a></li><li class=breadcrumb-item><a href=/docs/app-dev/>App Development</a></li><li class="breadcrumb-item active" aria-current=page>Client Messaging</li></ol></nav><div class=td-content><h1>Client Messaging</h1><header class=article-meta></header><p>Application extensions and the Onshape JavaScript web client need to communicate directly, calling across the iframe containing the application extension using post message.</p><p><img src=/images/javascriptpostmessageimage00.png alt="image alt text"></p><p>Onshape Client Messaging examples can be split into those that are initiated from the <em>application extension</em> and those that are initiated from the <em>Onshape client</em>.</p><h2 id=messages-from-the-extension>Messages from the Extension</h2><p>These Client Messaging examples can be initiated from the application extension:</p><ul><li><strong>Click/close flyouts events</strong>: Notify the Onshape client that the user has clicked in the application extension, which should cause Onshape flyouts (versions, history, uploads, etc.) and dropdown menus (profile dropdown menu, document menu) to close. Without this, flyouts and menus might remain open over the application extension.</li><li><strong>Shortcut keyboard events</strong>: Shortcut keys (such as <code>?</code>, which opens the Onshape Help dialog), can be handled by the application extension by posting a message to the Onshape client to open the dialog.</li><li><strong>keepAlive</strong>: Notify the Onshape client that the user is actively working in the application extension, which triggers the Onshape client to send a message to the server to keep the browser session alive. Without this, the Onshape browser session will timeout and ask the user to sign in again.</li><li><strong>Standard Onshape dialogs</strong>: Request from the application extension to the Onshape client to open one of the Onshape standard dialogs and send the user’s choices back to the application extension. For example, if the application extension needs the user to choose a part or assembly to be operated on, the application extension can post a message to the Onshape client requesting that dialog be opened and the selected part or assembly information sent back to the application extension.</li><li><strong>UI customization</strong>": Request from the application extension to the Onshape client to customize the Onshape UI (e.g., add commands to menus, add buttons to the toolbars, etc). When these commands or toolbar buttons are clicked, the Onshape client posts a message to the application extension with the available context.<ul><li><strong>Note</strong>: This is limited to cases where the application extension is made active by the user; application extensions are not automatically loaded when a document is opened. Most UI customizations should be done when you register the application with Onshape, as those change the Onshape client automatically without needing to load the application extension first.</li></ul></li><li><strong>Content/material insertion</strong>: Request from the application extension to insert content into the Onshape document. For example, insert a part into a new or existing Part Studio, apply a material to a part, add a material to a material library, etc.</li></ul><h2 id=messages-from-onshape>Messages from Onshape</h2><p>The following examples can be initiated from the Onshape client:</p><ul><li><strong>User action notification</strong>: The Onshape client can notify an application extension when various user actions occur. For example, the Onshape client might notify when the user has made the application extension active or inactive (when the user clicks on document tabs). When an application extension is made inactive, it is moved off the edges of the browser, so it cannot be seen, but is still active, preserving its state.</li><li><strong>Printing</strong>: The Onshape client can notify an application extension when the user has chosen the <strong>Print</strong> command from the main Onshape document menu, enabling the application extension to perform a print operation.</li></ul><h2 id=security-considerations>Security Considerations</h2><p>To ensure security, an application extension must:</p><ul><li><strong>Parse for document, workspace, and element IDs</strong>: Parse for the <code>documentId</code>, <code>workspaceId</code>, and <code>elementId</code> that were passed as query parameters within the application extension’s iframe <code>src</code> URL. You must post these back in each <code>POST</code> message.</li><li><strong>Parse for the server</strong>: Parse for the <code>server</code> that was passed as a query parameter within the application extension’s iframe <code>src</code> URL. You must use this to validate messages received.<ul><li>If the application extension uses a JavaScript library or framework (e.g., BackboneJS or AngularJS), it can parse the query parameters and maintain state in other ways.</li></ul></li><li><strong>Not redirect to another base URL</strong>: The browser tells the Onshape client the origin base URL from which a <code>POST</code> message is received. The Onshape client ignores messages posted from an origin URL that doesn’t match the original iframe <code>src</code> URL. It is <em>extremely important</em> to the security of your application that you verify that the origin of all messages you receive is the same as the original server query parameter in the iframe <code>src</code> (i.e., <code>if (server === e.origin)</code>). In production operation especially, the message IS NOT SAFE if the message origin does not match the iframe <code>src</code> server query parameter. Application extensions should not redirect to another base URL after the iframe has been opened, or the messages will be ignored.</li><li><strong>Post a message on startup</strong>: Onshape will not post messages until a newly started application extension has first posted a valid message to Onshape. This constraint is in effect anytime an application extension is (re)started and exists to avoid posting messages to application extensions that are not ready to handle them, are not fully loaded, etc. After your application extension is fully loaded and ready to receive messages, post a message to Onshape. A <code>keepAlive</code> message is a great first message to send to Onshape. Once Onshape receives a valid message, Onshape will start posting messages to the application extension. If the application extension later sends an invalid message Onshape will stop sending messages until a valid message is posted to Onshape.</li></ul><p><code>POST</code> messages submitted by application extensions to Onshape will be ignored if any of the following are true:</p><ul><li>The documentId, workspaceId, or elementId are missing or not valid.</li><li>The message name is missing or not recognized.</li><li>The origin of the <code>POST</code> message does not match the original iframe <code>src</code> URL.</li></ul><h2 id=element-tab>Element Tab</h2><p>Messages may be sent and received by element tab application extensions.</p><p>The following messages can be <strong>sent</strong> by Element tab application extensions:</p><table><tr><td>messageName
(case sensitive)</td><td>other message properties?</td><td>comment</td></tr><tr><td>applicationInit</td><td>yes<pre><code>notifyWhenSaveRequired: whether Onshape should send a notification to save pending changes during certain operations
(default is false)
</code></pre></td><td>Send once on application startup.</td></tr><tr><td>closeFlyoutsAndMenus</td><td>no</td><td>Send when a mouse click or other event happens in the application extension. Closes Onshape flyouts and dropdown menus.</td></tr><tr><td>closeSelectItemDialog</td><td>no</td><td>Closes the select item dialog.</td></tr><tr><td>connectionLost</td><td>no</td><td>Displays the standard Onshape connection lost message in a message bubble, forcing the user to either reload the document or return to the documents page.</td></tr><tr><td>errorReload</td><td>yes<pre><code>message: your message
</code></pre></td><td>Similar to the connectionLost message, but enables an application to specify the first part of the message, which will be used instead of "Onshape is not connected." The user must reload the document or return to the documents page.</td></tr><tr><td>finishedSaving</td><td>yes<pre><code>messageId: the id sent in the corresponding 'saveChanges' message
</code></pre></td><td>Response to a 'saveChanges' message sent from Onshape. Should be sent after application has cleaned up any pending edits.</td></tr><tr><td>keepAlive</td><td>no</td><td>Send periodically while while the user is actively working to avoid the session from timing out.</td></tr><tr><td>saveAVersion</td><td>no</td><td>Send when the user types “Shift-S” in the application extension, the keyboard shortcut for save a version.</td></tr><tr><td>showKeyboardShortcutsHelp</td><td>no</td><td>Send when the user types “?” (Shift-? on most keyboards) in the application extension, the keyboard shortcut for the keyboard shortcuts help dialog.</td></tr><tr><td>showMessageBubble</td><td>yes<pre><code>message: your message
</code></pre></td><td>Send when you want to show a string in the blue message bubble at the top of the Onshape app.</td></tr><tr><td>startLoadingSpinner</td><td>yes<pre><code>message: your message
</code></pre></td><td>Send to start a large spinner in the middle of the browser window with your message underneath it.</td></tr><tr><td>stopLoadingSpinner</td><td>no</td><td>Send to stop the large spinner.</td></tr><tr><td>startWorkingSpinner</td><td>no</td><td>Send to start a small spinner in the middle bottom of the browser window.</td></tr><tr><td>stopWorkingSpinner</td><td>no</td><td>Send to stop the small spinner.</td></tr><tr><td>openSelectItemDialog</td><td>yes<pre><code>dialogTitle: your dialog title
 (default is no title),
selectBlobs: true or false
 (default is false),
selectParts: true or false
 (default is false),
selectPartStudios: true or false
 (default is false),
selectAssemblies: true or false
 (default is false),
selectMultiple: true or false
 (default is false),
selectBlobMimeTypes: ‘comma-delimited string of blob mime types to show in dialog (e.g. “application/dwt,application/dwg”)’
 (default is an empty string)
showBrowseDocuments: true or false - controls whether ‘Other documents’ choice should be available
 (default is true)
showStandardContent: true or false - controls whether ‘Standard content’ choice should be available
 (default is false)
</code></pre></td><td>Send when your application wants to open a dialog in which the user will select one or multiple items - blobs, parts, part studios or assemblies.</td></tr><tr><td>requestCameraProperties</td><td>yes<pre><code>graphicsElementId: string , Element ID of the part studio or assembly
</code></pre></td><td>Send to request camera properties of a specific part studio or assembly element. Note: The element should have been opened at least once in the current session. The messageName of the response is cameraProperties</td></tr></table><p>The following messages can be <strong>received</strong> by Element tab application extensions:</p><table><tr><td>messageName
(case sensitive)</td><td>other message properties?</td><td>comment</td></tr><tr><td>show</td><td>no</td><td>Sent when an element tab application extension is shown (made active) within the Onshape client. This message is NOT sent when the element tab application extension is created.</td></tr><tr><td>hide</td><td>no</td><td>Sent when an element tab application extension is made inactive within the Onshape client. This message is NOT sent when an element tab application extension is deleted.</td></tr><tr><td>itemSelectedInSelectItemDialog</td><td>yes<pre><code>documentId: id of selected item’s document,
workspaceId: id of selected item’s workspace, empty if versionId not empty,
versionId: id of selected item’s version, empty if workspaceId not empty,
elementId: id of element selected or containing the selected part,
elementName: name of element selected or containing the selected part,
elementType: type of element selected or containing the selected part - ‘partstudio’, ‘assembly’ or ‘blob’,
elementMicroversionId: microversion id of the element,
itemType: type of item selected: ‘part’,‘partStudio’ or ‘assembly’,
partName: name of part selected, empty if itemType is not ‘part’,
idTag: id of part, empty if no part selected
</code></pre></td><td>Sent when the user selects an item (blob, part, part studio or assembly) in the select item dialog that was opened due to an openSelectItemDialog message sent earlier.
When a part is not selected, the partXxx message properties will be empty strings.</td></tr><tr><td>print</td><td>no</td><td>Sent when the user chooses the Print command while the application is the active element. The application can choose to handle this as either a print or an export to a PDF or other format.</td></tr><tr><td>selectItemDialogClosed</td><td>no</td><td>Sent when the select item dialog closes, either because the user selected an item and selectMultiple is false, or the user changed the active element or the user closed the dialog with the "X" button.</td></tr><tr><td>startFirstViewCommand</td><td>yes<pre><code>documentId: id of selected item’s document,
workspaceId: id of selected item’s workspace, empty if versionId not empty,
versionId: id of selected item’s version, empty if workspaceId not empty,
elementId: id of element selected or containing the selected part,
elementName: name of element selected or containing the selected part,
elementType: type of element selected or containing the selected part - ‘partstudio’, ‘assembly’ or ‘blob’,
elementMicroversionId: microversion id of the element,
itemType: type of item selected: ‘part’,‘partstudio’ or ‘assembly’,
partName: name of part selected, empty if itemType is not ‘part’,
idTag: id of part
</code></pre></td><td>Sent to a drawings application extension when the drawing is created with zero views.<p>If other types of applications need a message posted to them with creation context, contact Onshape and we can discuss using this sort of message for your application also.</td></p></tr><tr><td>export</td><td>yes<pre><code>fileExtension: the file extension of the export type the user chose - “.dwg”, “.dxf” are the types currently supported.
baseFileName: the base portion of the expected output file.  This is currently set to “&lt;document name&gt; - &lt;element name&gt;”
</code></pre></td><td>Sent when the user chooses a command to export the contents of the application to a file.</td></tr><tr><td>cameraProperties</td><td>yes<pre><code>graphicsElementId: string , Element ID of the part studio or assembly
isValid: boolean, Indicates if the properties are valid or not. false if element ID is invalid or element has not been open in the current session
projectionType: string, Denotes the projection method. Values are ‘orthographic’, ‘perspective’ . Empty string ‘’ if isValid is false
viewMatrix: 16 element numeric matrix with elements at index 13, 14, 15 corresponding to position of the camera
projectionMatrix: 16 element numeric matrix
verticalFieldOfView: number, 0 in case of orthographic projection
viewportHeight:      number, eight of the viewport
viewportWidth:       number, width of the viewport
</code></pre></td><td>Sent when application posts a requestCameraProperties message</td></tr><tr><td>takeFocus</td><td>no</td><td>Sent when the Onshape client sets focus on the content window of the element tab application extension.</td></tr><tr><td>saveChanges</td><td>yes<pre><code>messageId: a unique identifier for this message. Should be passed back in the 'finishedSaving' message.
</code></pre></td><td>Sent if the application specified 'notifyWhenSaveRequired' in the 'applicationInit' message. Indicates that the application should cleanup any pending edits before an Onshape process continues (i.e. version save).</td></tr></table><h2 id=element-right-panel>Element Right Panel</h2><p>Most client messaging functionality had been limited to that occurring between the Onshape client and application elements (the <strong>Element tab</strong> location). Limited functionality in now also available for client messaging to work with application extensions in the <strong>Element right panel</strong> location.</p><p>Enabled messaging to Element right panel extensions includes the communication of selections that the user makes for the following application extension contexts:</p><ul><li>Part Studio</li><li>Assembly</li><li>Document</li></ul><p>All <a href=#security-considerations>Security Considerations</a> above apply to both Element tab and Element right panel extensions, with the following notes:</p><ul><li>Initial message from the application extension to the Onshape client, in the form of an <code>applicationInit</code> message (or one of any other messages supported by the element right panel extensions), is required to ensure the Onshape client does not send messages to the extension until it is ready.</li><li>Once a valid <code>applicationInit</code> message is received by the Onshape client, it will start sending messages with the <code>messageName</code> value <code>SELECTION</code> upon user selection interactions.</li><li>Prior to accepting <em>any</em> message from the Onshape client as secure, the <code>origin</code> attribute value included in incoming messages must be validated as equal to the original <code>server</code> query parameter value used to load the application extension.</li></ul><h2 id=code-snippets>Code Snippets</h2><h3 id=parse-query-parameters>Parse query parameters</h3><p>This JavaScript code parses the iframe <code>src</code> query parameters and uses them to post a message:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>  <span style=color:#00a>var</span> documentId;
</span></span><span style=display:flex><span>  <span style=color:#00a>var</span> workspaceId;
</span></span><span style=display:flex><span>  <span style=color:#00a>var</span> elementId;
</span></span><span style=display:flex><span>  <span style=color:#00a>var</span> server;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aaa;font-style:italic>// Parse query parameters
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>  <span style=color:#00a>var</span> queryParameters = <span style=color:#0aa>decodeURIComponent</span>(<span style=color:#0aa>window</span>.location.search.substr(<span style=color:#099>1</span>));
</span></span><span style=display:flex><span>  <span style=color:#00a>var</span> queryParametersArray = queryParameters.split(<span style=color:#a50>&#39;&amp;&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#00a>for</span> (<span style=color:#00a>var</span> i = <span style=color:#099>0</span>; i &lt; queryParametersArray.length; i++) {
</span></span><span style=display:flex><span>    <span style=color:#00a>var</span> parameterArray = queryParametersArray[i].split(<span style=color:#a50>&#39;=&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#00a>if</span> (parameterArray.length === <span style=color:#099>2</span>) {
</span></span><span style=display:flex><span>      <span style=color:#00a>switch</span> (parameterArray[<span style=color:#099>0</span>]) {
</span></span><span style=display:flex><span>        <span style=color:#00a>case</span> <span style=color:#a50>&#39;documentId&#39;</span>:
</span></span><span style=display:flex><span>          documentId = parameterArray[<span style=color:#099>1</span>];
</span></span><span style=display:flex><span>          <span style=color:#00a>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#00a>case</span> <span style=color:#a50>&#39;workspaceId&#39;</span>:
</span></span><span style=display:flex><span>          workspaceId = parameterArray[<span style=color:#099>1</span>];
</span></span><span style=display:flex><span>          <span style=color:#00a>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#00a>case</span> <span style=color:#a50>&#39;elementId&#39;</span>:
</span></span><span style=display:flex><span>          elementId = parameterArray[<span style=color:#099>1</span>];
</span></span><span style=display:flex><span>          <span style=color:#00a>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#00a>case</span> <span style=color:#a50>&#39;server&#39;</span>:
</span></span><span style=display:flex><span>          server = parameterArray[<span style=color:#099>1</span>];
</span></span><span style=display:flex><span>          <span style=color:#00a>break</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aaa;font-style:italic>// Listen for clicks and post a message to the Onshape client
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>  <span style=color:#0aa>document</span>.getElementById(<span style=color:#a50>&#39;&lt;id of your topmost element&gt;&#39;</span>).
</span></span><span style=display:flex><span>    addEventListener(<span style=color:#a50>&#39;click&#39;</span>, <span style=color:#00a>function</span>() {
</span></span><span style=display:flex><span>      <span style=color:#00a>var</span> message = {documentId: documentId,
</span></span><span style=display:flex><span>                     workspaceId: workspaceId,
</span></span><span style=display:flex><span>                     elementId: elementId,
</span></span><span style=display:flex><span>                     messageName: <span style=color:#a50>&#39;closeFlyoutsAndMenus&#39;</span>};
</span></span><span style=display:flex><span>      <span style=color:#0aa>window</span>.parent.postMessage(message, <span style=color:#a50>&#39;*&#39;</span>);
</span></span><span style=display:flex><span>    }, <span style=color:#00a>true</span>);
</span></span></code></pre></div><h3 id=create-a-message-object>Create a message object</h3><p>The message object posted to the Onshape client is of the form:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>{
</span></span><span style=display:flex><span>    documentId: documentId,
</span></span><span style=display:flex><span>     workspaceId: workspaceId,
</span></span><span style=display:flex><span>     elementId: elementId,
</span></span><span style=display:flex><span>     messageName: <span style=color:#a50>&#39;&lt;message name&gt;&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#aaa;font-style:italic>// … other properties as needed for other message types …
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>}
</span></span></code></pre></div><p>The message data object posted to the application extension is of the form:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>{
</span></span><span style=display:flex><span>    messageName: <span style=color:#a50>&#39;&lt;message name&gt;&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#aaa;font-style:italic>//    … other properties as needed for other message types …
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>}
</span></span></code></pre></div><p>The message will always have a <code>messageName</code> property.</p><h3 id=listen-for-messages>Listen for messages</h3><p>To listen for messages from the Onshape client:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>  <span style=color:#aaa;font-style:italic>// server is one of the iframe src query parameters - see above
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#00a>var</span> handlePostMessage = <span style=color:#00a>function</span>(e) {
</span></span><span style=display:flex><span>    console.log(<span style=color:#a50>&#34;Post message received in application extension.&#34;</span>);
</span></span><span style=display:flex><span>    console.log(<span style=color:#a50>&#34;e.origin = &#34;</span> + e.origin);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#aaa;font-style:italic>// Verify the origin matches the server iframe src query parameter
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>    <span style=color:#00a>if</span> (server === e.origin) {
</span></span><span style=display:flex><span>      console.log(<span style=color:#a50>&#34;Message safe and can be handled as it is from origin &#39;&#34;</span>
</span></span><span style=display:flex><span>                  + e.origin +
</span></span><span style=display:flex><span>                  <span style=color:#a50>&#34;&#39;, which matches server query parameter &#39;&#34;</span>
</span></span><span style=display:flex><span>                  + server + <span style=color:#a50>&#34;&#39;.&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#00a>if</span> (e.data &amp;&amp; e.data.messageName) {
</span></span><span style=display:flex><span>        console.log(<span style=color:#a50>&#34;Message name = &#39;&#34;</span> + e.data.messageName + <span style=color:#a50>&#34;&#39;&#34;</span>);
</span></span><span style=display:flex><span>      } <span style=color:#00a>else</span> {
</span></span><span style=display:flex><span>        console.log(<span style=color:#a50>&#34;Message name not found. Ignoring message.&#34;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    } <span style=color:#00a>else</span> {
</span></span><span style=display:flex><span>      console.log(<span style=color:#a50>&#34;Message NOT safe and should be ignored.&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#0aa>window</span>.addEventListener(<span style=color:#a50>&#39;message&#39;</span>, handlePostMessage, <span style=color:#00a>false</span>);
</span></span></code></pre></div><h3 id=send-and-handle-messages>Send and handle messages</h3><p>The following is an example of how one might send an initialization message to, and handle post messages from, the Onshape client.</p><blockquote><p><em><strong>Note:</strong></em> Proper clean-up of event listeners is not included in the snippet</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#00a>function</span> handlePostMessage(event) {
</span></span><span style=display:flex><span>  <span style=color:#aaa;font-style:italic>// ensure that the event data is from a legit source:
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>  <span style=color:#00a>if</span>(theServerStringFromActionUrl !== event.origin) {
</span></span><span style=display:flex><span>    console.error(<span style=color:#a50>&#39;origin of message is not legitimate&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#00a>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#aaa;font-style:italic>// branch based on messageName attribute
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>  <span style=color:#00a>switch</span>(event.data.messageName) {
</span></span><span style=display:flex><span>    <span style=color:#00a>case</span> <span style=color:#a50>&#39;SELECTION&#39;</span>:
</span></span><span style=display:flex><span>      console.debug(<span style=color:#a50>&#39;SELECTION event data: %o&#39;</span>, event.data);
</span></span><span style=display:flex><span>      <span style=color:#00a>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#00a>default</span>:
</span></span><span style=display:flex><span>      console.debug(<span style=color:#a50>`</span><span style=color:#a50>${</span>event.data.messageName<span style=color:#a50>}</span><span style=color:#a50> not handled`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0aa>window</span>.addEventListener(<span style=color:#a50>&#39;message&#39;</span>, handlePostMessage);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a>const</span> initMessage = {
</span></span><span style=display:flex><span>  documentId:  theDocumentId,    <span style=color:#aaa;font-style:italic>// required - parsed from action url
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>  workspaceId: theWorkspaceId,   <span style=color:#aaa;font-style:italic>// required - parsed from action url
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>  elementId:   theElementId,     <span style=color:#aaa;font-style:italic>// required - parsed from action url
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>  messageName: <span style=color:#a50>&#39;applicationInit&#39;</span> <span style=color:#aaa;font-style:italic>// required
</span></span></span><span style=display:flex><span><span style=color:#aaa;font-style:italic></span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0aa>window</span>.parent.postMessage(initMessage, <span style=color:#a50>&#39;*&#39;</span>);
</span></span></code></pre></div><h3 id=right-panel-interaction-sequence>Right panel interaction sequence</h3><p>The sequence diagram below illustrates the interaction between an Element right panel application extension and the Onshape client:</p><pre class=mermaid>%%{
  init: {
    &#34;theme&#34;: &#34;default&#34;,
    &#34;sequence&#34;: {
      &#34;mirrorActors&#34;: false,
      &#34;showSequenceNumbers&#34;: false,
      &#34;width&#34;: 75,
      &#34;height&#34;: 60,
      &#34;actorMargin&#34;: 25,
      &#34;messageFontSize&#34;: 13,
      &#34;messageFontFamily&#34;: &#34;monospace&#34;,
      &#34;messageFontWeight&#34;: 2
    }
  }
}%%
sequenceDiagram
  actor user
  participant OSC AS Onshape Client
  participant AE AS Application Extension
  user-&gt;&gt;&#43;OSC: start element right panel extension
  Note right of user: via configured button
  OSC-&gt;&gt;&#43;AE: invoke action url (with query params)
  AE-&gt;&gt;OSC: postMessage(messageName: &#39;applicationInit&#39;)
  loop selection interactions
    user-&gt;&gt;OSC: select
    OSC-&gt;&gt;AE: postMessage(messageName: &#39;SELECTION&#39;)
  end
  user-&gt;&gt;OSC: stop element right panel extension
    Note right of user: via configured button
  deactivate AE
  OSC-XAE: destroy
  deactivate OSC</pre><h3 id=right-panel-message-exchange>Right panel message exchange</h3><p>The following messages are exchanged for application extensions located in the element right panel and configured for Part Studio, Assembly, or Document contexts.</p><p>The first message with <code>messageName</code> attribute set to <code>applicationInit</code> is sent to the Onshape client by an application extension once it is loaded and ready to receive and process incoming messages:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        documentId: <span style=color:#a50>&#39;&lt;document id&gt;&#39;</span>,
</span></span><span style=display:flex><span>        workspaceId: <span style=color:#a50>&#39;&lt;workspace id&gt;&#39;</span>,
</span></span><span style=display:flex><span>        elementId: <span style=color:#a50>&#39;&lt;element id&gt;&#39;</span>,
</span></span><span style=display:flex><span>        messageName: <span style=color:#a50>&#39;applicationInit&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>The values <code>&lt;document id></code>, <code>&lt;workspace id></code>, <code>&lt;element id></code>, and <code>&lt;server id></code>:</p><ul><li>Are originally included as query parameters in the action URL used to request the content of the application extension</li><li>Must be included in messages sent to the Onshape client</li></ul><p>While initialization is the specific intent of the <code>applicationInit</code> message, other supported <code>messageName</code> attributes have the same initialization effect upon their first receipt by the Onshape client.</p><p>Next, as the user interacts with Onshape by selecting various parts of the model, messages with the <code>messageName</code> attribute set to <code>SELECTION</code> are sent to the application extension:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>{
</span></span><span style=display:flex><span>    messageName: <span style=color:#a50>&#39;SELECTION&#39;</span>,
</span></span><span style=display:flex><span>    selections: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            selectionType: <span style=color:#a50>&#39;ENTITY&#39;</span>,
</span></span><span style=display:flex><span>            selectionId: <span style=color:#a50>&#39;KRiB&#39;</span>,
</span></span><span style=display:flex><span>            entityType: <span style=color:#a50>&#39;FACE&#39;</span>,
</span></span><span style=display:flex><span>            occurrencePath: [
</span></span><span style=display:flex><span>                <span style=color:#a50>&#39;MfOieM8xKIDGHe37c&#39;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            workspaceMicroversionId: <span style=color:#a50>&#39;a781c53fbd1095e3462d2b70&#39;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            selectionType: <span style=color:#a50>&#39;ENTITY&#39;</span>,
</span></span><span style=display:flex><span>            selectionId: <span style=color:#a50>&#39;KRdC&#39;</span>,
</span></span><span style=display:flex><span>            entityType: <span style=color:#a50>&#39;EDGE&#39;</span>,
</span></span><span style=display:flex><span>            occurrencePath: [
</span></span><span style=display:flex><span>                <span style=color:#a50>&#39;MfOieM8xKIDGHe37c&#39;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            workspaceMicroversionId: <span style=color:#a50>&#39;a781c53fbd1095e3462d2b70&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=notes>Notes</h2><h3 id=keyboard-focus>Keyboard focus</h3><p>Keyboard focus will not be transferred to an application until the user clicks in the application or the application programmatically takes focus. An application should programmatically take focus when it is first loaded and when it receives a <code>show</code> message from Onshape. Shortcut keys will work immediately when the application is shown.</p><h3 id=future-work>Future work</h3><ul><li>New message types will be added as needed. If your application extension needs a message not listed in this document, please notify us, and we’ll work with you on it.</li><li>Mobile client support is unclear at this time.</li><li>Onshape is considering using promises to wrap <code>POST</code> messages, which would make the application extension&rsquo;s JavaScript simpler and enable chaining <code>POST</code>s with other operations. Promises would make some interactions with multiple responses difficult (e.g., when you open a dialog, like the Select Item dialog, and want to receive multiple <code>POST</code> messages back due to the user clicking on multiple items in the dialog).</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"></div></div></div></footer></div><script type=module async>
  import mermaid from "https:\/\/cdn.jsdelivr.net\/npm\/mermaid@latest\/dist\/mermaid.esm.min.mjs";

  (function ($) {
    if ($('.mermaid').length == 0) {
      mermaid.initialize({ startOnLoad: false });
      return;
    }

    var params = {"enable":true};

    
    
    var norm = function (defaultConfig, params) {
      var result = {};
      for (const key in defaultConfig) {
        const keyLower = key.toLowerCase();
        if (defaultConfig.hasOwnProperty(key) && params.hasOwnProperty(keyLower)) {
          if (typeof defaultConfig[key] === "object") {
            result[key] = norm(defaultConfig[key], params[keyLower]);
          } else {
            result[key] = params[keyLower];
          }
        }
      }
      return result;
    };

    var settings = norm(mermaid.mermaidAPI.defaultConfig, params);
    settings.startOnLoad = true;
    if ($('html[data-bs-theme="dark"]').length) {
      settings.theme = 'dark';
    }
    mermaid.initialize(settings);

    
    const lightDarkModeThemeChangeHandler = function (mutationsList, observer) {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
          
          
          
          location.reload();
        }
      }
    };

    const observer = new MutationObserver(lightDarkModeThemeChangeHandler);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-bs-theme']
    });
    

  })(jQuery);
</script><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>